openapi: 3.1.0
info:
  title: My BiblioConnect API
  version: 1.0.0
  description: |
    API REST du projet My BiblioConnect.
    Permet la gestion de bibliothèques personnelles, la recherche de livres,
    la gestion des souhaits, des amis et des avis.
    ---
    ### Accès utilisateur simple
    Les comptes standards peuvent :
    - consulter le catalogue et les fiches détaillées des livres, ainsi que les avis publics ;
    - suivre les statistiques publiques via `/stats/highlights` et `/stats/public-overview` ;
    - gérer leur profil, leurs relations sociales et leurs listes personnelles (bibliothèque et wishlist) ;
    - publier ou mettre à jour leurs propres avis et retirer des ouvrages de leurs listes personnelles uniquement.
    ### Restrictions
    - aucune suppression ou modification du catalogue (livres, auteurs, genres) n'est proposée aux utilisateurs simples ;
    - les opérations d'administration sont documentées séparément et nécessitent un rôle interne ;
    - les seules suppressions autorisées concernent des ressources personnelles comme la bibliothèque, la wishlist ou les relations que l'utilisateur possède.
  contact:
    name: Nexross
    url: https://github.com/Nexross13/biblioconnecte
    email: noreply.biblioconnect@gmail.com
servers:
  - url: https://api.my-biblioconnect.fr/api/v1
    description: Serveur principal
tags:
  - name: Authentification
    description: Flux publics d'inscription, de connexion et de récupération de mot de passe.
    x-simple-user-access: public
  - name: Utilisateurs
    description: Consultation et mise à jour de son profil, ainsi que la gestion de ses relations (amis).
    x-simple-user-access: self
  - name: Livres
    description: Consultation du catalogue et des détails d'ouvrages ; toute modification est réservée à l'équipe.
    x-simple-user-access: read-only
  - name: Auteurs
    description: Consultation des fiches auteurs ; modifications limitées au personnel interne.
    x-simple-user-access: read-only
  - name: Genres
    description: Navigation dans les genres référencés ; administration interne uniquement.
    x-simple-user-access: read-only
  - name: Bibliothèque
    description: Gestion complète de sa bibliothèque personnelle (ajout et retrait de livres appartenant à l'utilisateur).
    x-simple-user-access: self
  - name: Wishlist
    description: Gestion de la liste d'envies d'un utilisateur (ajout/retrait de livres suivis).
    x-simple-user-access: self
  - name: Avis
    description: Lecture des avis publics et contribution de l'utilisateur sur des ouvrages.
    x-simple-user-access: self
  - name: Statistiques
    description: Indicateurs globaux ou personnalisés accessibles en lecture seule.
    x-simple-user-access: read-only
security:
  - bearerAuth: []
x-simple-user-endpoints:
  - label: Statistiques globales
    method: GET
    path: /stats/highlights
    description: Consulter les faits marquants partagés (livres récents, lecteurs actifs).
  - label: Vue publique des métriques
    method: GET
    path: /stats/public-overview
    description: Récupérer les volumes de lectures, avis et livres disponibles.
  - label: Parcourir le catalogue
    method: GET
    path: /books
    description: Liste paginée des ouvrages consultable par tout utilisateur authentifié.
  - label: Détail d'un livre
    method: GET
    path: /books/{bookId}
    description: Fiche détaillée d'un livre spécifique.
  - label: Consulter les avis d'un livre
    method: GET
    path: /books/{bookId}/reviews
    description: Lecture des avis publiés pour un ouvrage donné.
  - label: Publier un avis
    method: POST
    path: /books/{bookId}/reviews
    description: Création d'un avis associé à un livre par l'utilisateur courant.
  - label: Gérer ma bibliothèque
    method: GET
    path: /library
    description: Liste des livres ajoutés par l'utilisateur dans sa bibliothèque personnelle.
  - label: Ajouter un livre à ma bibliothèque
    method: POST
    path: /library/{bookId}
    description: Ajout d'un livre accessible au catalogue dans la bibliothèque de l'utilisateur.
  - label: Retirer un livre de ma bibliothèque
    method: DELETE
    path: /library/{bookId}
    description: 'Seule suppression autorisée pour un utilisateur : retirer un livre qui lui appartient.'
  - label: Consulter ma wishlist
    method: GET
    path: /wishlist
    description: Visualisation de la liste d'envies personnelle.
  - label: Ajouter un livre à ma wishlist
    method: POST
    path: /wishlist/{bookId}
    description: Suivre un livre sans l'ajouter à la bibliothèque.
  - label: Retirer un livre de ma wishlist
    method: DELETE
    path: /wishlist/{bookId}
    description: Nettoyer sa liste d'envies personnelle.
  - label: Proposer un nouvel auteur
    method: POST
    path: /author-proposals
    description: Soumettre un auteur à l'équipe éditoriale pour validation.
  - label: Mettre à jour mon profil
    method: PUT
    path: /users/{id}
    description: Modifier ses propres informations (nom, avatar, email, mot de passe) ; l'ID doit correspondre à l'utilisateur connecté.
paths:
  /auth/register:
    post:
      tags:
        - Authentification
      summary: Inscription d'un utilisateur
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              inscription:
                summary: Inscription
                value:
                  firstName: Alice
                  lastName: Martin
                  login: alice
                  email: alice@example.com
                  password: Mot2PasseSecurise!
                  dateOfBirth: '1990-03-12'
      responses:
        '201':
          description: Utilisateur créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                created:
                  value:
                    token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
                    user:
                      id: 42
                      login: alice
                      firstName: Alice
                      lastName: Martin
                      email: alice@example.com
                      dateOfBirth: '1990-03-12'
                      createdAt: '2024-03-21T10:00:00.000Z'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Un compte existe déjà avec cet email
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                conflict:
                  value:
                    message: An account already exists with this email
        '500':
          $ref: '#/components/responses/InternalError'
  /auth/login:
    post:
      tags:
        - Authentification
      summary: Connexion d'un utilisateur
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
            examples:
              login:
                value:
                  identifier: alice
                  password: Mot2PasseSecurise!
      responses:
        '200':
          description: Authentification réussie
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                success:
                  value:
                    token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
                    user:
                      id: 42
                      login: alice
                      firstName: Alice
                      lastName: Martin
                      email: alice@example.com
                      dateOfBirth: '1990-03-12'
                      createdAt: '2024-03-21T10:00:00.000Z'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /auth/google:
    post:
      tags:
        - Authentification
      summary: Authentification via Google OAuth 2.0
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GoogleLoginRequest'
            examples:
              google:
                value:
                  credential: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Authentification réussie via Google
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /auth/me:
    get:
      tags:
        - Authentification
      summary: Récupérer le profil courant
      responses:
        '200':
          description: Profil de l'utilisateur courant
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
              examples:
                me:
                  value:
                    user:
                      id: 42
                      firstName: Alice
                      lastName: Martin
                      email: alice@example.com
                      createdAt: '2024-03-21T10:00:00.000Z'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /auth/password/forgot:
    post:
      tags:
        - Authentification
      summary: Demander un code de réinitialisation de mot de passe
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetRequest'
            examples:
              forgot:
                value:
                  email: alice@example.com
      responses:
        '200':
          description: Demande prise en compte (le message reste générique)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetMessageResponse'
              examples:
                generic:
                  value:
                    message: If an account matches this email, we have sent a verification code.
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'
  /auth/password/verify:
    post:
      tags:
        - Authentification
      summary: Vérifier un code de réinitialisation de mot de passe
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetVerifyRequest'
            examples:
              verify:
                value:
                  email: alice@example.com
                  code: '123456'
      responses:
        '200':
          description: Code valide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetVerifyResponse'
              examples:
                valid:
                  value:
                    valid: true
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'
  /auth/password/reset:
    post:
      tags:
        - Authentification
      summary: Réinitialiser un mot de passe à l'aide d'un code
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetFinalizeRequest'
            examples:
              reset:
                value:
                  email: alice@example.com
                  code: '123456'
                  password: NouveauMotDePasse1!
      responses:
        '200':
          description: Mot de passe mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetMessageResponse'
              examples:
                success:
                  value:
                    message: Password updated successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'
  /users:
    get:
      tags:
        - Utilisateurs
      summary: Lister les utilisateurs
      responses:
        '200':
          description: Liste des utilisateurs
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
              examples:
                list:
                  value:
                    users:
                      - id: 1
                        login: alice
                        firstName: Alice
                        lastName: Martin
                        email: alice@biblio.test
                        createdAt: '2024-01-10T08:00:00.000Z'
                      - id: 2
                        login: benoit
                        firstName: Benoit
                        lastName: Durand
                        email: benoit@biblio.test
                        createdAt: '2024-01-12T10:15:00.000Z'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /users/{id}:
    get:
      tags:
        - Utilisateurs
      summary: Récupérer un utilisateur
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Utilisateur trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
              examples:
                user:
                  value:
                    user:
                      id: 1
                      firstName: Alice
                      lastName: Martin
                      email: alice@biblio.test
                      createdAt: '2024-01-10T08:00:00.000Z'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      tags:
        - Utilisateurs
      summary: Mettre à jour le profil d'un utilisateur
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
                  minLength: 8
                profileImage:
                  type: string
                  format: binary
              required:
                - firstName
                - lastName
                - email
      responses:
        '200':
          description: Profil mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /users/{id}/friends:
    get:
      tags:
        - Utilisateurs
      summary: Lister les amis d'un utilisateur
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Liste des amis
          content:
            application/json:
              schema:
                type: object
                properties:
                  friends:
                    type: array
                    items:
                      $ref: '#/components/schemas/Friend'
              examples:
                friends:
                  value:
                    friends:
                      - id: 2
                        firstName: Benoit
                        lastName: Durand
                        email: benoit@biblio.test
                        status: accepted
                        since: '2024-02-01T12:00:00.000Z'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
  /users/{id}/friends/requests:
    get:
      tags:
        - Utilisateurs
      summary: Lister les demandes d'amis reçues
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Demandes reçues
          content:
            application/json:
              schema:
                type: object
                properties:
                  requests:
                    type: array
                    items:
                      type: object
                      properties:
                        requesterId:
                          type: integer
                        firstName:
                          type: string
                        lastName:
                          type: string
                        email:
                          type: string
                        requestedAt:
                          type: string
                          format: date-time
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
  /users/{id}/friends/{friendId}/reject:
    post:
      tags:
        - Utilisateurs
      summary: Refuser une demande d'ami
      parameters:
        - $ref: '#/components/parameters/UserId'
        - $ref: '#/components/parameters/FriendId'
      responses:
        '204':
          description: Demande refusée
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
  /users/{id}/library:
    get:
      tags:
        - Utilisateurs
      summary: Consulter la bibliothèque d'un ami
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Livres possédés
          content:
            application/json:
              schema:
                type: object
                properties:
                  books:
                    type: array
                    items:
                      $ref: '#/components/schemas/LibraryEntry'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /users/{id}/wishlist:
    get:
      tags:
        - Utilisateurs
      summary: Consulter la wishlist d'un ami
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Liste de souhaits
          content:
            application/json:
              schema:
                type: object
                properties:
                  books:
                    type: array
                    items:
                      $ref: '#/components/schemas/WishlistEntry'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags:
        - Utilisateurs
      summary: Envoyer une demande d'ami
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '201':
          description: Demande envoyée
          content:
            application/json:
              schema:
                type: object
                properties:
                  friendship:
                    $ref: '#/components/schemas/Friendship'
              examples:
                pending:
                  value:
                    friendship:
                      requesterId: 1
                      addresseeId: 2
                      status: pending
                      requestedAt: '2024-03-15T09:30:00.000Z'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
  /users/{id}/friends/{friendId}/accept:
    put:
      tags:
        - Utilisateurs
      summary: Accepter une demande d'ami
      parameters:
        - $ref: '#/components/parameters/UserId'
        - $ref: '#/components/parameters/FriendId'
      responses:
        '200':
          description: Demande d'ami acceptée
          content:
            application/json:
              schema:
                type: object
                properties:
                  friendship:
                    $ref: '#/components/schemas/Friendship'
              examples:
                accepted:
                  value:
                    friendship:
                      requesterId: 1
                      addresseeId: 2
                      status: accepted
                      requestedAt: '2024-03-15T09:30:00.000Z'
                      acceptedAt: '2024-03-16T14:05:00.000Z'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /users/{id}/friends/{friendId}:
    delete:
      tags:
        - Utilisateurs
      summary: Supprimer un ami
      description: Opération limitée aux utilisateurs concernés pour mettre fin à une relation existante.
      parameters:
        - $ref: '#/components/parameters/UserId'
        - $ref: '#/components/parameters/FriendId'
      responses:
        '204':
          description: Amitié supprimée
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /books:
    get:
      tags:
        - Livres
      summary: Lister les livres
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
          description: Nombre maximum de livres à retourner
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Décalage pour la pagination
        - name: search
          in: query
          schema:
            type: string
          description: Filtrer les livres par titre, auteur ou ISBN
      responses:
        '200':
          description: Liste paginée des livres
          content:
            application/json:
              schema:
                type: object
                properties:
                  books:
                    type: array
                    items:
                      $ref: '#/components/schemas/Book'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
              examples:
                paginated:
                  value:
                    books:
                      - id: 1
                        title: Le Petit Prince
                        isbn: '9780156013987'
                        edition: Gallimard
                        volume: '1'
                        summary: Conte poétique et philosophique raconté par un aviateur.
                        createdAt: '2024-01-01T00:00:00.000Z'
                        updatedAt: '2024-01-01T00:00:00.000Z'
                      - id: 2
                        title: 1984
                        isbn: '9780451524935'
                        edition: Secker & Warburg
                        volume: '1'
                        summary: Dystopie décrivant un régime totalitaire.
                        createdAt: '2024-01-05T00:00:00.000Z'
                        updatedAt: '2024-01-05T00:00:00.000Z'
                    pagination:
                      limit: 25
                      offset: 0
                      count: 2
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags:
        - Livres
      summary: Créer un livre
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookCreateRequest'
            examples:
              create:
                value:
                  title: Fondation
                  isbn: '9782070360536'
                  edition: Folio SF
                  volume: '1'
                  summary: Cycle de science-fiction d'Isaac Asimov.
                  authorIds: [1, 2]
                  genreIds: [1, 3]
      responses:
        '201':
          description: Livre créé
          content:
            application/json:
              schema:
                type: object
                properties:
                  book:
                    $ref: '#/components/schemas/Book'
              examples:
                created:
                  value:
                    book:
                      id: 10
                      title: Fondation
                      isbn: '9782070360536'
                      edition: Folio SF
                      volume: '1'
                      summary: Cycle de science-fiction d'Isaac Asimov.
                      authors:
                        - id: 1
                          firstName: Isaac
                          lastName: Asimov
                      genres:
                        - id: 3
                      name: Science-fiction
                      createdAt: '2024-03-20T11:45:00.000Z'
                      updatedAt: '2024-03-20T11:45:00.000Z'
        '202':
          description: Proposition de livre enregistrée pour validation (utilisateur non administrateur)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  proposal:
                    $ref: '#/components/schemas/BookProposal'
              examples:
                submitted:
                  value:
                    message: Livre envoyé pour validation par un administrateur
                    proposal:
                      id: 42
                      title: Fondation
                      status: pending
                      submittedAt: '2024-04-18T10:12:00.000Z'
                      submittedBy:
                        id: 5
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /books/{id}:
    get:
      tags:
        - Livres
      summary: Récupérer un livre
      parameters:
        - $ref: '#/components/parameters/BookId'
      responses:
        '200':
          description: Livre trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  book:
                    $ref: '#/components/schemas/Book'
              examples:
                book:
                  value:
                    book:
                      id: 1
                      title: Le Petit Prince
                      isbn: '9780156013987'
                      edition: Gallimard
                      volume: '1'
                      summary: Conte poétique et philosophique raconté par un aviateur.
                      authors:
                        - id: 1
                          firstName: Antoine
                          lastName: de Saint-Exupéry
                      genres:
                        - id: 1
                          name: Fiction
                        - id: 3
                          name: Philosophie
                      createdAt: '2024-01-01T00:00:00.000Z'
                      updatedAt: '2024-01-01T00:00:00.000Z'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      tags:
        - Livres
      summary: Mettre à jour un livre
      parameters:
        - $ref: '#/components/parameters/BookId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookUpdateRequest'
            examples:
              update:
                value:
                  title: Le Petit Prince (édition illustrée)
                  authorIds: [1]
                  genreIds: [1, 3]
      responses:
        '200':
          description: Livre mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  book:
                    $ref: '#/components/schemas/Book'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      tags:
        - Livres
      summary: Supprimer un livre
      description: Réservé aux administrateurs/modérateurs du catalogue.
      parameters:
        - $ref: '#/components/parameters/BookId'
      responses:
        '204':
          description: Livre supprimé
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /books/{id}/authors:
    get:
      tags:
        - Livres
      summary: Lister les auteurs d'un livre
      parameters:
        - $ref: '#/components/parameters/BookId'
      responses:
        '200':
          description: Auteurs associés
          content:
            application/json:
              schema:
                type: object
                properties:
                  authors:
                    type: array
                    items:
                      $ref: '#/components/schemas/Author'
              examples:
                authors:
                  value:
                    authors:
                      - id: 1
                        firstName: Antoine
                        lastName: de Saint-Exupéry
                        biography: Aviateur et écrivain français.
                        createdAt: '2023-12-10T09:00:00.000Z'
                        updatedAt: '2023-12-10T09:00:00.000Z'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /books/{id}/genres:
    get:
      tags:
        - Livres
      summary: Lister les genres d'un livre
      parameters:
        - $ref: '#/components/parameters/BookId'
      responses:
        '200':
          description: Genres associés
          content:
            application/json:
              schema:
                type: object
                properties:
                  genres:
                    type: array
                    items:
                      $ref: '#/components/schemas/Genre'
              examples:
                genres:
                  value:
                    genres:
                      - id: 1
                        name: Fiction
                        createdAt: '2023-12-01T00:00:00.000Z'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /authors:
    get:
      tags:
        - Auteurs
      summary: Lister les auteurs
      responses:
        '200':
          description: Liste des auteurs
          content:
            application/json:
              schema:
                type: object
                properties:
                  authors:
                    type: array
                    items:
                      $ref: '#/components/schemas/Author'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags:
        - Auteurs
      summary: Créer un auteur
      description: Réservé aux administrateurs.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorCreateRequest'
            examples:
              create:
                value:
                  firstName: Ursula
                  lastName: Le Guin
                  biography: Autrice américaine de science-fiction.
      responses:
        '201':
          description: Auteur créé
          content:
            application/json:
              schema:
                type: object
                properties:
                  author:
                    $ref: '#/components/schemas/Author'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /authors/{id}:
    get:
      tags:
        - Auteurs
      summary: Récupérer un auteur
      parameters:
        - $ref: '#/components/parameters/AuthorId'
      responses:
        '200':
          description: Auteur trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  author:
                    $ref: '#/components/schemas/Author'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      tags:
        - Utilisateurs
      summary: Mettre à jour un auteur
      parameters:
        - $ref: '#/components/parameters/AuthorId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorUpdateRequest'
      responses:
        '200':
          description: Profil mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      tags:
        - Auteurs
      summary: Supprimer un auteur
      description: Réservé aux administrateurs/modérateurs.
      parameters:
        - $ref: '#/components/parameters/AuthorId'
      responses:
        '204':
          description: Auteur supprimé
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /authors/{id}/books:
    get:
      tags:
        - Auteurs
      summary: Lister les livres d'un auteur
      parameters:
        - $ref: '#/components/parameters/AuthorId'
      responses:
        '200':
          description: Livres associés à l'auteur
          content:
            application/json:
              schema:
                type: object
                properties:
                  books:
                    type: array
                    items:
                      $ref: '#/components/schemas/Book'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /genres:
    get:
      tags:
        - Genres
      summary: Lister les genres
      responses:
        '200':
          description: Liste des genres
          content:
            application/json:
              schema:
                type: object
                properties:
                  genres:
                    type: array
                    items:
                      $ref: '#/components/schemas/Genre'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags:
        - Genres
      summary: Créer un genre
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenreCreateRequest'
            examples:
              create:
                value:
                  name: Fantasy
      responses:
        '201':
          description: Genre créé
          content:
            application/json:
              schema:
                type: object
                properties:
                  genre:
                    $ref: '#/components/schemas/Genre'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /genres/{id}/books:
    get:
      tags:
        - Genres
      summary: Lister les livres associés à un genre
      parameters:
        - $ref: '#/components/parameters/GenreId'
      responses:
        '200':
          description: Livres du genre
          content:
            application/json:
              schema:
                type: object
                properties:
                  books:
                    type: array
                    items:
                      $ref: '#/components/schemas/Book'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /genres/{id}:
    delete:
      tags:
        - Genres
      summary: Supprimer un genre
      description: Réservé aux administrateurs/modérateurs.
      parameters:
        - $ref: '#/components/parameters/GenreId'
      responses:
        '204':
          description: Genre supprimé
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /library:
    get:
      tags:
        - Bibliothèque
      summary: Lister les livres de ma bibliothèque
      responses:
        '200':
          description: Livres de la bibliothèque personnelle
          content:
            application/json:
              schema:
                type: object
                properties:
                  books:
                    type: array
                    items:
                      $ref: '#/components/schemas/LibraryEntry'
              examples:
                library:
                  value:
                    books:
                      - id: 1
                        title: Le Petit Prince
                        isbn: '9780156013987'
                        edition: Gallimard
                        volume: '1'
                        addedAt: '2024-03-01T12:00:00.000Z'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /library/{bookId}:
    post:
      tags:
        - Bibliothèque
      summary: Ajouter un livre à ma bibliothèque
      parameters:
        - $ref: '#/components/parameters/BookIdPath'
      responses:
        '201':
          description: Livre ajouté
          content:
            application/json:
              schema:
                type: object
                properties:
                  entry:
                    $ref: '#/components/schemas/LibraryEntry'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      tags:
        - Bibliothèque
      summary: Retirer un livre de ma bibliothèque
      description: 'Unique suppression autorisée pour un utilisateur standard : retirer un livre qu''il possède.'
      parameters:
        - $ref: '#/components/parameters/BookIdPath'
      responses:
        '204':
          description: Livre retiré
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /book-proposals:
    post:
      tags:
        - Livres
      summary: Soumettre une proposition de livre
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookCreateRequest'
            examples:
              proposal:
                value:
                  title: Fondation
                  isbn: '9782070360536'
                  edition: Folio SF
                  volume: '1'
                  summary: Cycle de science-fiction d'Isaac Asimov.
                  authorNames:
                    - Isaac Asimov
                  genreNames:
                    - Science-fiction
                    - Classique
                  releaseDate: '2001-01-15'
                  coverImage: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA
      responses:
        '202':
          description: Proposition de livre enregistrée
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  proposal:
                    $ref: '#/components/schemas/BookProposal'
              examples:
                created:
                  value:
                    message: Livre envoyé pour validation par un administrateur
                    proposal:
                      id: 42
                      title: Fondation
                      status: pending
                      submittedAt: '2024-04-18T10:12:00.000Z'
                      submittedBy:
                        id: 5
                      authorNames:
                        - Isaac Asimov
                      genreNames:
                        - Science-fiction
                        - Classique
                      releaseDate: '2001-01-15'
                      coverImagePath: /assets/books/proposals/proposal-1719943500.jpg
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    get:
      tags:
        - Livres
      summary: Lister les propositions de livres (administrateur)
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
          description: Nombre maximum de propositions à retourner
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Décalage pour la pagination
        - name: status
          in: query
          schema:
            type: string
            enum:
              - pending
              - approved
              - rejected
          description: Filtrer les propositions selon leur statut
      responses:
        '200':
          description: Liste paginée des propositions
          content:
            application/json:
              schema:
                type: object
                properties:
                  proposals:
                    type: array
                    items:
                      $ref: '#/components/schemas/BookProposal'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
  /book-proposals/mine:
    get:
      tags:
        - Livres
      summary: Lister mes propositions de livres
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
          description: Nombre maximum de propositions à retourner
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Décalage pour la pagination
      responses:
        '200':
          description: Liste paginée de mes propositions
          content:
            application/json:
              schema:
                type: object
                properties:
                  proposals:
                    type: array
                    items:
                      $ref: '#/components/schemas/BookProposal'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /book-proposals/{id}:
    get:
      tags:
        - Livres
      summary: Consulter une proposition de livre
      parameters:
        - $ref: '#/components/parameters/BookProposalId'
      responses:
        '200':
          description: Proposition trouvée
          content:
            application/json:
              schema:
                type: object
                properties:
                  proposal:
                    $ref: '#/components/schemas/BookProposal'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /book-proposals/{id}/approve:
    post:
      tags:
        - Livres
      summary: Valider une proposition de livre
      parameters:
        - $ref: '#/components/parameters/BookProposalId'
      responses:
        '200':
          description: Proposition approuvée
          content:
            application/json:
              schema:
                type: object
                properties:
                  proposal:
                    $ref: '#/components/schemas/BookProposal'
                  book:
                    $ref: '#/components/schemas/Book'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'
  /book-proposals/{id}/reject:
    post:
      tags:
        - Livres
      summary: Refuser une proposition de livre
      parameters:
        - $ref: '#/components/parameters/BookProposalId'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: Motif du refus
      responses:
        '200':
          description: Proposition refusée
          content:
            application/json:
              schema:
                type: object
                properties:
                  proposal:
                    $ref: '#/components/schemas/BookProposal'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /author-proposals:
    get:
      tags:
        - Auteurs
      summary: Lister les propositions d'auteurs
      description: Réservé aux administrateurs.
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum:
              - pending
              - approved
              - rejected
          description: Filtrer par statut
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Propositions d'auteurs
          content:
            application/json:
              schema:
                type: object
                properties:
                  proposals:
                    type: array
                    items:
                      $ref: '#/components/schemas/AuthorProposal'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags:
        - Auteurs
      summary: Proposer un nouvel auteur
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorProposalCreateRequest'
            examples:
              submit:
                value:
                  firstName: Nnedi
                  lastName: Okorafor
                  biography: Autrice nigériano-américaine de science-fiction.
      responses:
        '202':
          description: Auteur soumis pour validation
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  proposal:
                    $ref: '#/components/schemas/AuthorProposal'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /author-proposals/{id}:
    get:
      tags:
        - Auteurs
      summary: Consulter une proposition d'auteur
      description: Réservé aux administrateurs.
      parameters:
        - $ref: '#/components/parameters/AuthorProposalId'
      responses:
        '200':
          description: Proposition d'auteur
          content:
            application/json:
              schema:
                type: object
                properties:
                  proposal:
                    $ref: '#/components/schemas/AuthorProposal'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /author-proposals/{id}/approve:
    post:
      tags:
        - Auteurs
      summary: Approuver une proposition d'auteur
      description: Réservé aux administrateurs.
      parameters:
        - $ref: '#/components/parameters/AuthorProposalId'
      responses:
        '200':
          description: Auteur validé
          content:
            application/json:
              schema:
                type: object
                properties:
                  proposal:
                    $ref: '#/components/schemas/AuthorProposal'
                  author:
                    $ref: '#/components/schemas/Author'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'
  /author-proposals/{id}/reject:
    post:
      tags:
        - Auteurs
      summary: Refuser une proposition d'auteur
      description: Réservé aux administrateurs.
      parameters:
        - $ref: '#/components/parameters/AuthorProposalId'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: Motif du refus
      responses:
        '200':
          description: Proposition refusée
          content:
            application/json:
              schema:
                type: object
                properties:
                  proposal:
                    $ref: '#/components/schemas/AuthorProposal'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'
  /wishlist:
    get:
      tags:
        - Wishlist
      summary: Lister les livres de ma liste de souhaits
      responses:
        '200':
          description: Livres de la wishlist
          content:
            application/json:
              schema:
                type: object
                properties:
                  books:
                    type: array
                    items:
                      $ref: '#/components/schemas/WishlistEntry'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /wishlist/{bookId}:
    post:
      tags:
        - Wishlist
      summary: Ajouter un livre à ma wishlist
      parameters:
        - $ref: '#/components/parameters/BookIdPath'
      responses:
        '201':
          description: Livre ajouté à la wishlist
          content:
            application/json:
              schema:
                type: object
                properties:
                  entry:
                    $ref: '#/components/schemas/WishlistEntry'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      tags:
        - Wishlist
      summary: Retirer un livre de ma wishlist
      description: Suppression limitée à la wishlist personnelle de l'utilisateur.
      parameters:
        - $ref: '#/components/parameters/BookIdPath'
      responses:
        '204':
          description: Livre retiré de la wishlist
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /books/{bookId}/reviews:
    get:
      tags:
        - Avis
      summary: Lister les avis d'un livre
      parameters:
        - $ref: '#/components/parameters/BookId'
      responses:
        '200':
          description: Avis associés au livre
          content:
            application/json:
              schema:
                type: object
                properties:
                  reviews:
                    type: array
                    items:
                      $ref: '#/components/schemas/Review'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags:
        - Avis
      summary: Créer un avis pour un livre
      parameters:
        - $ref: '#/components/parameters/BookId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReviewCreateRequest'
            examples:
              create:
                value:
                  rating: 5
                  comment: Un coup de coeur absolu.
      responses:
        '201':
          description: Avis créé
          content:
            application/json:
              schema:
                type: object
                properties:
                  review:
                    $ref: '#/components/schemas/Review'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /reviews/{id}:
    put:
      tags:
        - Avis
      summary: Mettre à jour un avis
      parameters:
        - $ref: '#/components/parameters/ReviewId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReviewUpdateRequest'
      responses:
        '200':
          description: Avis mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  review:
                    $ref: '#/components/schemas/Review'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      tags:
        - Avis
      summary: Supprimer un avis
      description: Seul l'auteur de l'avis ou un modérateur peut effectuer cette suppression.
      parameters:
        - $ref: '#/components/parameters/ReviewId'
      responses:
        '204':
          description: Avis supprimé
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
  /stats/highlights:
    get:
      tags:
        - Statistiques
      summary: Récupérer les indicateurs clés
      description: Retourne le lecteur le plus actif, le livre le mieux noté et les cinq derniers ouvrages ajoutés.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Indicateurs calculés
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HighlightsResponse'
              examples:
                highlights:
                  value:
                    topReader:
                      user:
                        id: 1
                        firstName: Alice
                        lastName: Martin
                        email: alice@biblio.test
                        createdAt: '2024-01-10T08:00:00.000Z'
                      totalBooks: 12
                    topRatedBook:
                      book:
                        id: 2
                        title: 1984
                        summary: Dystopie décrivant un régime totalitaire.
                        createdAt: '2024-01-05T00:00:00.000Z'
                      averageRating: 4.8
                      totalReviews: 5
                    latestBooks:
                      - id: 10
                        title: Fondations
                        summary: Cycle de science-fiction d'Isaac Asimov.
                        createdAt: '2024-04-01T10:00:00.000Z'
                      - id: 9
                        title: Le Comte de Monte-Cristo
                        summary: Roman d'aventure d'Alexandre Dumas.
                        createdAt: '2024-03-28T14:20:00.000Z'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
  /stats/public-overview:
    get:
      tags:
        - Statistiques
      summary: Obtenir un aperçu public du catalogue
      description: Donne un aperçu chiffré du catalogue et de la communauté, accessible sans authentification.
      responses:
        '200':
          description: Aperçu agrégé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicOverviewResponse'
              examples:
                overview:
                  value:
                    counts:
                      members: 1240
                      books: 3620
                      authors: 890
                      genres: 42
                      reviews: 1875
                      pendingProposals: 8
                      libraryEntries: 9720
                      acceptedFriendships: 540
                    activity:
                      booksAddedLast30Days: 120
                      newMembersLast30Days: 85
                    popularGenres:
                      - id: 5
                        name: Science-fiction
                        bookCount: 220
                      - id: 2
                        name: Fantasy
                        bookCount: 198
                    recentBooks:
                      - id: 42
                        title: La Passe-miroir
                        summary: Premier tome de la saga de Christelle Dabos.
                        createdAt: '2024-05-01T08:00:00.000Z'
                        updatedAt: '2024-05-01T08:00:00.000Z'
        '500':
          $ref: '#/components/responses/InternalError'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: >
        Fournir le jeton JWT obtenu lors de la connexion via l'en-tête `Authorization: Bearer <token>`.
  parameters:
    UserId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: Identifiant de l'utilisateur
    FriendId:
      name: friendId
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: Identifiant de l'ami ciblé
    BookId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: Identifiant du livre
    BookIdPath:
      name: bookId
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: Identifiant du livre
    AuthorId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: Identifiant de l'auteur
    GenreId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: Identifiant du genre
    ReviewId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: Identifiant de l'avis
    BookProposalId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: Identifiant de la proposition de livre
    AuthorProposalId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        minimum: 1
      description: Identifiant de la proposition d'auteur
  responses:
    BadRequest:
      description: Requête invalide
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            badRequest:
              value:
                message: Missing registration fields
    Unauthorized:
      description: Authentification requise ou invalide
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            unauthorized:
              value:
                message: Missing bearer token
    Forbidden:
      description: Action non autorisée
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            forbidden:
              value:
                message: You are not allowed to perform this action
    Conflict:
      description: Conflit avec l'état actuel de la ressource
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            conflict:
              value:
                message: Proposal is not pending
    NotFound:
      description: Ressource non trouvée
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            notFound:
              value:
                message: Resource not found
    InternalError:
      description: Erreur interne du serveur
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            internal:
              value:
                message: Internal server error
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        login:
          type: string
          example: alice
        firstName:
          type: string
          example: Alice
        lastName:
          type: string
          example: Martin
        email:
          type: string
          format: email
          example: alice@biblio.test
        dateOfBirth:
          type: string
          format: date
          nullable: true
          example: '1990-03-12'
        createdAt:
          type: string
          format: date-time
          example: '2024-01-10T08:00:00.000Z'
        role:
          type: string
          enum:
            - user
            - admin
          example: user
      required:
        - id
        - login
        - firstName
        - lastName
        - email
        - createdAt
        - role
    Friend:
      type: object
      properties:
        id:
          type: integer
          example: 2
        firstName:
          type: string
          example: Benoit
        lastName:
          type: string
          example: Durand
        email:
          type: string
          format: email
          example: benoit@biblio.test
        status:
          type: string
          description: Statut de la relation
          enum:
            - pending
            - accepted
            - rejected
          example: accepted
        since:
          type: string
          format: date-time
          nullable: true
          example: '2024-02-01T12:00:00.000Z'
      required:
        - id
        - firstName
        - lastName
        - email
        - status
    Friendship:
      type: object
      properties:
        requesterId:
          type: integer
          example: 1
        addresseeId:
          type: integer
          example: 2
        status:
          type: string
          enum:
            - pending
            - accepted
            - rejected
          example: pending
        requestedAt:
          type: string
          format: date-time
          example: '2024-03-15T09:30:00.000Z'
        acceptedAt:
          type: string
          format: date-time
          nullable: true
          example: '2024-03-16T14:05:00.000Z'
      required:
        - requesterId
        - addresseeId
        - status
        - requestedAt
    Book:
      type: object
      properties:
        id:
          type: integer
          example: 1
        title:
          type: string
          example: Le Petit Prince
        isbn:
          type: string
          example: '9780156013987'
        edition:
          type: string
          example: Gallimard
        volume:
          type: string
          nullable: true
          example: '1'
        releaseDate:
          type: string
          format: date
          nullable: true
          example: '2001-01-15'
        summary:
          type: string
          nullable: true
          example: Conte poétique et philosophique raconté par un aviateur.
        authors:
          type: array
          items:
            $ref: '#/components/schemas/Author'
        genres:
          type: array
          items:
            $ref: '#/components/schemas/Genre'
        createdAt:
          type: string
          format: date-time
          example: '2024-01-01T00:00:00.000Z'
        updatedAt:
          type: string
          format: date-time
          example: '2024-01-01T00:00:00.000Z'
      required:
        - id
        - title
        - createdAt
        - updatedAt
    BookProposal:
      type: object
      properties:
        id:
          type: integer
          example: 12
        title:
          type: string
          example: Fondation
        isbn:
          type: string
          nullable: true
          example: '9782070360536'
        edition:
          type: string
          nullable: true
          example: Folio SF
        volume:
          type: string
          nullable: true
          example: '1'
        summary:
          type: string
          nullable: true
          example: Cycle de science-fiction d'Isaac Asimov.
        authorNames:
          type: array
          items:
            type: string
          example: []
        genreNames:
          type: array
          items:
            type: string
          example: []
        coverImagePath:
          type: string
          nullable: true
          example: /assets/books/proposals/proposal-1719943500.jpg
        status:
          type: string
          enum:
            - pending
            - approved
            - rejected
          example: pending
        submittedBy:
          type: object
          properties:
            id:
              type: integer
              example: 5
            firstName:
              type: string
              nullable: true
              example: Jeanne
            lastName:
              type: string
              nullable: true
              example: Dupont
            email:
              type: string
              nullable: true
              format: email
              example: jeanne@biblio.test
          required:
            - id
        submittedAt:
          type: string
          format: date-time
          example: '2024-05-12T09:30:00.000Z'
        decidedBy:
          type: object
          nullable: true
          properties:
            id:
              type: integer
              example: 1
            firstName:
              type: string
              nullable: true
              example: Alice
            lastName:
              type: string
              nullable: true
              example: Martin
            email:
              type: string
              nullable: true
              format: email
              example: alice@biblio.test
        decidedAt:
          type: string
          nullable: true
          format: date-time
          example: '2024-05-13T14:45:00.000Z'
        rejectionReason:
          type: string
          nullable: true
          example: Doublon détecté dans la base.
      required:
        - id
        - title
        - status
        - submittedBy
        - submittedAt
    AuthorProposal:
      type: object
      properties:
        id:
          type: integer
          example: 4
        firstName:
          type: string
          example: Nnedi
        lastName:
          type: string
          example: Okorafor
        biography:
          type: string
          nullable: true
          example: Autrice nigériano-américaine de science-fiction.
        status:
          type: string
          enum:
            - pending
            - approved
            - rejected
          example: pending
        submittedBy:
          type: object
          nullable: true
          properties:
            id:
              type: integer
              example: 2
            firstName:
              type: string
              nullable: true
              example: Benoit
            lastName:
              type: string
              nullable: true
              example: Durand
            email:
              type: string
              nullable: true
              format: email
              example: benoit@biblio.test
        submittedAt:
          type: string
          format: date-time
          example: '2024-04-20T09:30:00.000Z'
        decidedBy:
          type: object
          nullable: true
          properties:
            id:
              type: integer
            firstName:
              type: string
              nullable: true
            lastName:
              type: string
              nullable: true
        decidedAt:
          type: string
          format: date-time
          nullable: true
        rejectionReason:
          type: string
          nullable: true
      required:
        - id
        - firstName
        - lastName
        - status
        - submittedAt
    AuthorProposalCreateRequest:
      type: object
      properties:
        firstName:
          type: string
          example: Nnedi
        lastName:
          type: string
          example: Okorafor
        biography:
          type: string
          nullable: true
          example: Autrice nigériano-américaine de science-fiction.
      required:
        - firstName
        - lastName
    BookCreateRequest:
      type: object
      properties:
        title:
          type: string
        isbn:
          type: string
        edition:
          type: string
        volume:
          type: string
        releaseDate:
          type: string
          format: date
          nullable: true
        summary:
          type: string
        authorIds:
          type: array
          items:
            type: integer
        genreIds:
          type: array
          items:
            type: integer
        authorNames:
          type: array
          description: Liste de noms d'auteurs (utilisée lors d'une proposition)
          items:
            type: string
        genreNames:
          type: array
          description: Liste de genres textuels (utilisée lors d'une proposition)
          items:
            type: string
        coverImage:
          type: string
          nullable: true
          description: Image de couverture encodée en base64 (data URL)
      required:
        - title
    BookUpdateRequest:
      type: object
      properties:
        title:
          type: string
        isbn:
          type: string
        edition:
          type: string
        volume:
          type: string
        releaseDate:
          type: string
          format: date
          nullable: true
        summary:
          type: string
        authorIds:
          type: array
          items:
            type: integer
        genreIds:
          type: array
          items:
            type: integer
    Author:
      type: object
      properties:
        id:
          type: integer
          example: 1
        firstName:
          type: string
          example: Antoine
        lastName:
          type: string
          example: de Saint-Exupéry
        biography:
          type: string
          nullable: true
          example: Aviateur et écrivain français, auteur du Petit Prince.
        createdAt:
          type: string
          format: date-time
          example: '2023-12-10T09:00:00.000Z'
        updatedAt:
          type: string
          format: date-time
          example: '2023-12-10T09:00:00.000Z'
      required:
        - id
        - firstName
        - lastName
        - createdAt
        - updatedAt
    AuthorCreateRequest:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        biography:
          type: string
      required:
        - firstName
        - lastName
    AuthorUpdateRequest:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        biography:
          type: string
    Genre:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Fiction
        createdAt:
          type: string
          format: date-time
          example: '2023-12-01T00:00:00.000Z'
      required:
        - id
        - name
        - createdAt
    GenreCreateRequest:
      type: object
      properties:
        name:
          type: string
      required:
        - name
    Review:
      type: object
      properties:
        id:
          type: integer
          example: 1
        userId:
          type: integer
          example: 2
        bookId:
          type: integer
          example: 1
        rating:
          type: integer
          minimum: 1
          maximum: 5
          example: 5
        comment:
          type: string
          nullable: true
          example: Un classique touchant qui fait réfléchir.
        createdAt:
          type: string
          format: date-time
          example: '2024-03-12T10:00:00.000Z'
        updatedAt:
          type: string
          format: date-time
          example: '2024-03-12T10:00:00.000Z'
      required:
        - id
        - userId
        - bookId
        - rating
        - createdAt
        - updatedAt
    ReviewCreateRequest:
      type: object
      properties:
        rating:
          type: integer
          minimum: 1
          maximum: 5
        comment:
          type: string
      required:
        - rating
    ReviewUpdateRequest:
      type: object
      properties:
        rating:
          type: integer
          minimum: 1
          maximum: 5
        comment:
          type: string
    LibraryEntry:
      type: object
      properties:
        id:
          type: integer
          example: 1
        title:
          type: string
          example: Le Petit Prince
        isbn:
          type: string
          example: '9780156013987'
        edition:
          type: string
          example: Gallimard
        volume:
          type: string
          nullable: true
          example: '1'
        addedAt:
          type: string
          format: date-time
          example: '2024-03-01T12:00:00.000Z'
      required:
        - id
        - title
        - addedAt
    WishlistEntry:
      type: object
      properties:
        id:
          type: integer
          example: 3
        title:
          type: string
          example: Animal Farm
        isbn:
          type: string
          example: '9780451526342'
        edition:
          type: string
          example: Secker & Warburg
        volume:
          type: string
          nullable: true
        addedAt:
          type: string
          format: date-time
          example: '2024-03-10T08:35:00.000Z'
      required:
        - id
        - title
        - addedAt
    RegisterRequest:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        login:
          type: string
          description: Identifiant unique (3-30 caractères alphanumériques avec .-_).
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        dateOfBirth:
          type: string
          format: date
          description: Date de naissance au format ISO (YYYY-MM-DD)
      required:
        - firstName
        - lastName
        - login
        - email
        - password
    AuthRequest:
      type: object
      properties:
        identifier:
          type: string
          description: Login unique ou adresse email (prioritaire s'il est fourni).
        login:
          type: string
          description: Alias de `identifier` pour rétrocompatibilité.
        email:
          type: string
          format: email
          description: Adresse email (utilisée si `identifier` et `login` sont absents).
        password:
          type: string
          format: password
      required:
        - password
      anyOf:
        - required:
            - identifier
        - required:
            - login
        - required:
            - email
    AuthResponse:
      type: object
      properties:
        token:
          type: string
          description: Jeton JWT
        user:
          $ref: '#/components/schemas/User'
      required:
        - token
        - user
    PasswordResetRequest:
      type: object
      properties:
        email:
          type: string
          format: email
      required:
        - email
    GoogleLoginRequest:
      type: object
      properties:
        credential:
          type: string
          description: Jeton d'identité Google (ID token JWT)
      required:
        - credential
    PasswordResetVerifyRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        code:
          type: string
          pattern: '^\d{6}$'
      required:
        - email
        - code
    PasswordResetFinalizeRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        code:
          type: string
          pattern: '^\d{6}$'
        password:
          type: string
          format: password
          minLength: 8
      required:
        - email
        - code
        - password
    PasswordResetVerifyResponse:
      type: object
      properties:
        valid:
          type: boolean
          example: true
      required:
        - valid
    PasswordResetMessageResponse:
      type: object
      properties:
        message:
          type: string
      required:
        - message
    Pagination:
      type: object
      properties:
        limit:
          type: integer
          example: 25
        offset:
          type: integer
          example: 0
        count:
          type: integer
          example: 25
      required:
        - limit
        - offset
        - count
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          example: Resource not found
        details:
          type: object
          additionalProperties: true
          nullable: true
    HighlightsResponse:
      type: object
      properties:
        topReader:
          oneOf:
            - type: 'null'
            - type: object
              properties:
                user:
                  $ref: '#/components/schemas/User'
                totalBooks:
                  type: integer
                  example: 12
              required:
                - user
                - totalBooks
        topRatedBook:
          oneOf:
            - type: 'null'
            - type: object
              properties:
                book:
                  $ref: '#/components/schemas/Book'
                averageRating:
                  type: number
                  format: float
                  example: 4.8
                totalReviews:
                  type: integer
                  example: 5
              required:
                - book
                - averageRating
                - totalReviews
        latestBooks:
          type: array
          items:
            $ref: '#/components/schemas/Book'
      required:
        - latestBooks
    PopularGenre:
      type: object
      properties:
        id:
          type: integer
          example: 5
        name:
          type: string
          example: Science-fiction
        bookCount:
          type: integer
          example: 220
      required:
        - id
        - name
        - bookCount
    PublicOverviewResponse:
      type: object
      properties:
        counts:
          type: object
          properties:
            members:
              type: integer
              example: 1240
            books:
              type: integer
              example: 3620
            authors:
              type: integer
              example: 890
            genres:
              type: integer
              example: 42
            reviews:
              type: integer
              example: 1875
            pendingProposals:
              type: integer
              example: 8
            libraryEntries:
              type: integer
              example: 9720
            acceptedFriendships:
              type: integer
              example: 540
          required:
            - members
            - books
            - authors
            - genres
            - reviews
            - pendingProposals
            - libraryEntries
            - acceptedFriendships
        activity:
          type: object
          properties:
            booksAddedLast30Days:
              type: integer
              example: 120
            newMembersLast30Days:
              type: integer
              example: 85
          required:
            - booksAddedLast30Days
            - newMembersLast30Days
        recentBooks:
          type: array
          items:
            $ref: '#/components/schemas/Book'
        popularGenres:
          type: array
          items:
            $ref: '#/components/schemas/PopularGenre'
      required:
        - counts
        - activity
        - recentBooks
        - popularGenres
